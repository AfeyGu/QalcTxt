# QalcTxt Python计算器

一个功能强大的文本式计算器，支持实时数学计算、方程求解、行间结果引用、注释支持等高级功能。

## 功能特性

### 🧮 基本计算功能
- 支持基本四则运算：`+`, `-`, `*`, `/`, `//`, `%`, `**`
- 数学函数：`sin`, `cos`, `tan`, `log`, `exp`, `sqrt`, `factorial` 等
- 数学常数：`pi`, `e`, `tau`
- 复数运算支持
- 高精度计算

### 📐 方程求解
- 支持多种方程类型：
  - 线性方程：`2*x + 3 = 7`
  - 二次方程：`x^2 - 5*x + 6 = 0`
  - 高次方程：`x^3 - x^2 - x + 1 = 0`
  - solve函数调用：`solve(x^2 - 4, x)`
  - 多变量solve：`solve(x+y-11, x-y-1, [x,y])`
  - 方程组新语法：`x,y:x+y=11,x-y=1`
- 多解显示格式：`x[0] = 2, x[1] = 3`
- 智能行引用更新（插入/删除行时自动调整引用）

### 🔗 行引用系统
- `@3` - 引用第3行的完整结果
- `@3.0` - 引用第3行结果的第一个解
- `@3.1` - 引用第3行结果的第二个解
- 支持嵌套引用和复杂表达式

### 💬 注释支持
- 使用 `#` 表示注释
- 支持行内注释：`2 + 3 # 这是一个计算`
- 支持纯注释行：`# 这是说明文字`

### 💾 文件管理
- 支持保存为 `.qalc` 格式（完整计算历史）
- 支持导出为 `.txt` 格式（包含结果）
- 自动保存功能
- 文件加载和恢复

### 🖥️ 用户界面
- 类文本编辑器的简洁界面
- 实时结果显示
- 语法高亮
- 行号显示
- 状态栏信息

## 安装和运行

### 系统要求
- Python 3.8 或更高版本
- Windows, macOS, 或 Linux

### 安装依赖
```bash
pip install -r requirements.txt
```

主要依赖：
- `sympy>=1.9.0` - 符号计算和方程求解
- `numpy>=1.21.0` - 数值计算（可选）
- `scipy>=1.7.0` - 科学计算（可选）

### 运行程序
```bash
python main.py
```

## 使用说明

### 基本操作
1. 在文本编辑区域输入数学表达式
2. 按 `Enter` 键计算当前行
3. 按 `Shift+Enter` 键计算所有行
4. 结果会显示在右侧结果区域

### 快捷键
- `Enter` - 计算当前行
- `Shift+Enter` - 计算所有行
- `Ctrl+S` - 保存文件
- `Ctrl+O` - 打开文件
- `Ctrl+N` - 新建文件
- `Ctrl+Z` - 撤销
- `Ctrl+Y` - 重做
- `Ctrl+A` - 全选

### 示例用法

#### 基本计算
```
2 + 3
5 * 4
sqrt(16)
sin(pi/2)
```

#### 方程求解
```
x^2 = 9
solve(x^2 - 5*x + 6, x)
solve(sin(x), x)
# 方程组新语法（推荐）
x,y:x+y=11,x-y=1
a,b,c:a+b+c=6,a-b=1,2*a+c=7
# 多变量solve函数
solve(x+y-11, x-y-1, [x,y])
```

#### 行引用
```
2 + 3                    # 第1行：结果 = 5
4 * 5                    # 第2行：结果 = 20
@1 + @2                  # 第3行：引用第1行和第2行，结果 = 25
solve(x^2 - 1, x)        # 第4行：结果 = x[0] = -1, x[1] = 1
@4.0 + @4.1              # 第5行：引用第4行的两个解，结果 = 0
```

#### 注释使用
```
# 这是一个计算示例
2 + 3                    # 简单加法
5 * 4                    # 乘法运算
# 下面是方程求解
x^2 = 16                 # 二次方程
```

## 文件格式

### .qalc 格式
QalcTxt专用格式，保存完整的计算历史和结果，支持：
- 原始表达式
- 计算结果
- 方程解
- 时间戳
- 设置信息

### .txt 格式
纯文本格式，包含表达式和结果：
```
2 + 3  = 5
5 * 4  = 20
x^2 = 9  = x[0] = -3, x[1] = 3
```

## 技术架构

### 模块结构
```
QalcTxt/
├── main.py              # 主程序入口
├── core/                # 核心计算模块
│   ├── calculator.py    # 基础计算引擎
│   ├── equation_solver.py # 方程求解器
│   ├── parser.py        # 表达式解析器
│   └── result_manager.py # 结果管理器
├── gui/                 # 用户界面模块
│   ├── main_window.py   # 主窗口
│   ├── text_editor.py   # 文本编辑组件
│   └── file_operations.py # 文件操作
├── utils/               # 工具模块
│   └── file_manager.py  # 文件管理
└── tests/               # 单元测试
    ├── test_calculator.py
    ├── test_parser.py
    └── test_file_manager.py
```

### 核心技术
- **计算引擎**: 基于Python的安全表达式求值
- **方程求解**: 使用SymPy库进行符号计算
- **GUI框架**: tkinter（Python内置）
- **文件格式**: JSON格式存储计算历史

## 运行测试

### 单元测试
```bash
python -m unittest tests.test_calculator -v
python -m unittest tests.test_parser -v
python -m unittest tests.test_file_manager -v
```

### 功能测试
```bash
python test_functionality.py
```

## 开发信息

- **版本**: 1.0.0
- **开发语言**: Python
- **许可证**: MIT License
- **开发团队**: Calculator Team

## 贡献

欢迎提交问题报告和功能建议！

## 更新日志

### v1.0.0
- 初始版本发布
- 实现基本计算功能
- 添加方程求解支持
- 实现行引用系统
- 支持注释功能
- 完整的文件管理系统
- 用户友好的GUI界面